<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .login-container h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        
        .login-container p {
            color: #666;
            margin-bottom: 30px;
        }
        
        .telegram-widget {
            margin: 20px 0;
        }
        
        .info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h1>üõ† –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        <p>–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram</p>
        
        <div id="telegram-widget"></div>
        
        <div class="info" id="info-box">
            ‚ö†Ô∏è –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤<br>
            –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–π—Ç–∏ –ø–æ–¥ –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º Telegram:<br>
            ‚Ä¢ –æ—Ç–∫—Ä–æ–π —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –∏–ª–∏ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ;<br>
            ‚Ä¢ –ª–∏–±–æ –æ—á–∏—Å—Ç–∏ cookies –¥–ª—è telegram.org –∏ –æ–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
        </div>
    </div>
    
    <script>
        // –ü–æ–ª—É—á–∞–µ–º bot_username –∏–∑ —à–∞–±–ª–æ–Ω–∞
        const botUsername = "{{ bot_username }}";
        const botUsernameRaw = "{{ bot_username_raw }}";

        function renderTelegramWidget() {
            const cleanUsername = botUsername.replace('@', '').trim();
            if (!cleanUsername) {
                document.getElementById('telegram-widget').innerHTML =
                    '<p style="color: #dc3545;">‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π BOT_USERNAME.</p>' +
                    (botUsernameRaw ? ('<p style="color: #666; font-size: 0.9em;">–°–µ–π—á–∞—Å: <code>' + botUsernameRaw + '</code></p>') : '') +
                    '<p style="color: #666; font-size: 0.9em;">–ù—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å <b>username –±–æ—Ç–∞</b> –±–µ–∑ @ –∏ –æ–±—ã—á–Ω–æ –æ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ <code>bot</code> (–Ω–∞–ø—Ä–∏–º–µ—Ä: <code>fiorevpnbot</code>).</p>';
                return;
            }

            const widget = document.createElement('script');
            widget.src = 'https://telegram.org/js/telegram-widget.js?22';
            widget.setAttribute('data-telegram-login', cleanUsername);
            widget.setAttribute('data-size', 'large');
            widget.setAttribute('data-request-access', 'write'); // –ø—Ä–æ—Å–∏–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø
            widget.setAttribute('data-auth-url', window.location.origin + '/admin/auth/telegram');
            document.getElementById('telegram-widget').appendChild(widget);
        }

        (function init() {
            const urlParams = new URLSearchParams(window.location.search);

            // –ï—Å–ª–∏ –≤—ã—à–ª–∏ —Å drop_session=1 ‚Üí force_reauth=1, —á–∏—Å—Ç–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (urlParams.get('force_reauth') === '1') {
                try {
                    sessionStorage.clear();
                    localStorage.clear();
                } catch (e) {
                    // ignore
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫–∏ –≤ URL
            const error = urlParams.get('error');
            if (error) {
                const errorMessages = {
                    'not_admin': '‚ùå –í—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º',
                    'invalid_signature': '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏',
                    'expired': '‚ùå –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö –∏—Å—Ç–µ–∫'
                };
                const infoBox = document.getElementById('info-box');
                if (infoBox) {
                    infoBox.innerHTML = '<p style="color: #dc3545;">' + (errorMessages[error] || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏') + '</p>';
                }
            }

            renderTelegramWidget();
        })();
    </script>
</body>
</html>

